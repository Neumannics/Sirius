{% extends 'console.html' %}

{% block links %}
<script src="https://unpkg.com/popper.js/dist/umd/popper.min.js"></script><script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js"></script>
<script src="https://unpkg.com/popper.js/dist/umd/popper.min.js"></script>
<script src="https://unpkg.com/tooltip.js/dist/umd/tooltip.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.css">
{% endblock %}

{% block script %}
document.addEventListener('DOMContentLoaded', function() {
    const events = [];
    {% for event in events %}
        events.push({
            title: '{{ event.title }}',
            start: '{{ event.start|date:'c' }}',
            end: '{{ event.end|date:'c' }}',
            description: '{{ event.title }} ({{ event.start|date:'d M H:i' }} - {{ event.end|date:'d M H:i' }})',
            url: '{% url 'team:session:event_detail' pk=console.team.id e_pk=event.pk %}'
        });
    {% endfor %}
    console.log(events);
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        eventDidMount: function(info) {
            var tooltip = new Tooltip(info.el, {
                title: info.event.extendedProps.description,
                placement: 'top',
                trigger: 'hover',
                container: 'body'
            });
        },
        events: events
    });
    calendar.render();
});
{% endblock %}

{% block style %}
.fc .fc-button-primary {}
{% endblock %}

{% block workspace %}
<div class="flex flex-col w-full">
    <div class="module-head">
        <h2>Calendar</h2>
        {% if 'C-E' in console.perms %}
            <a href="{% url 'team:session:create_event' pk=console.team.id %}"><i class="fa-solid fa-calendar-plus add-icon"></i></a>
        {% endif %}
    </div>
    <p class="italic text-grey my-[8px]" id="remove-hint">Click on event tiles for additional details</p>
    <div id="calendar"></div>
</div>
{% endblock %}